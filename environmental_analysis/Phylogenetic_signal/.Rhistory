library(ape)
library(picante)
library(phytools)
library(dplyr)
# Load phylogenetic tree
myTree = read.nexus("pruned_tree.tre")
# Load phylogenetic tree
myTree = read.tree("pruned_tree.tre")
myTree
# Load trait data
myTrait = read.csv("pca.csv")
# Check if species names in the tree and trait data match
if (!all(names(myTrait) %in% myTree$tip.label)) {
stop("species names in trait data do not match the phylogenetic tree.")
}
# Check for duplicate rows
duplicate_rows <- duplicated(myTrait$Species)
duplicate_rows
# If there are duplicate rows, average them
if (any(duplicate_rows)) {
myTrait <- myTrait %>%
group_by(Species) %>%
summarize_all(mean, na.rm = TRUE) %>%
ungroup()
}
# Set species names as row names
rownames(myTrait) <- myTrait$Species
myTrait
# Extract species names from the trait data
trait_species <- unique(myTrait$Species)
# Extract species names from the tree
tree_species <- myTree$tip.label
# Identify species to remove
species_to_remove <- setdiff(tree_species, trait_species)
# Prune the tree
pruned_tree <- drop.tip(myTree, species_to_remove)
trait_species
tree_species
myTrait
# Load phylogenetic tree
myTree = read.tree("pruned_tree.tre")
# Load trait data
myTrait = read.csv("pca.csv")
# Check if species names in the tree and trait data match
if (!all(names(myTrait) %in% myTree$tip.label)) {
stop("species names in trait data do not match the phylogenetic tree.")
}
# Check for duplicate rows
duplicate_rows <- duplicated(myTrait$Species)
# If there are duplicate rows, average them
if (any(duplicate_rows)) {
myTrait <- myTrait %>%
group_by(Species) %>%
summarize_all(mean, na.rm = TRUE) %>%
ungroup()
}
# Set species names as row names
rownames(myTrait) <- myTrait$Species
myTrait
# Extract species names from the trait data
trait_species <- unique(myTrait$Species)
# Extract species names from the tree
tree_species <- myTree$tip.label
# Identify species to remove
species_to_remove <- setdiff(tree_species, trait_species)
# Prune the tree
pruned_tree <- drop.tip(myTree, species_to_remove)
trait_species
tree_species
species_to_remove
# Prune the tree
pruned_tree <- drop.tip(myTree, species_to_remove)
# Save the pruned tree
write.tree(pruned_tree, file = "pruned_tree_pca.tre") #use this to save your file
# Load phylogenetic tree
myTree = read.tree("datedFigTree.tre")
# Load phylogenetic tree
myTree = read.nexus("datedFigTree.tre")
# Load trait data
myTrait = read.csv("pca.csv")
# Check if species names in the tree and trait data match
if (!all(names(myTrait) %in% myTree$tip.label)) {
stop("species names in trait data do not match the phylogenetic tree.")
}
# Check for duplicate rows
duplicate_rows <- duplicated(myTrait$Species)
# If there are duplicate rows, average them
if (any(duplicate_rows)) {
myTrait <- myTrait %>%
group_by(Species) %>%
summarize_all(mean, na.rm = TRUE) %>%
ungroup()
}
# Set species names as row names
rownames(myTrait) <- myTrait$Species
myTrait
# Extract species names from the trait data
trait_species <- unique(myTrait$Species)
# Extract species names from the tree
tree_species <- myTree$tip.label
# Identify species to remove
species_to_remove <- setdiff(tree_species, trait_species)
trait_species
tree_species
species_to_remove
# Prune the tree
pruned_tree <- drop.tip(myTree, species_to_remove)
# Save the pruned tree
write.tree(pruned_tree, file = "pruned_tree_pca.tre") #use this to save your file
# Save the pruned tree
#write.tree(pruned_tree, file = "pruned_tree_pca.tre") #use this to save your file
tree = read.tree("pruned_tree_pca.tre")
# Match species names between tree and trait data
matched_species <- match(tree$tip.label, rownames(myTrait))
# Filter out NA values (species not found in trait data)
matched_species <- matched_species[!is.na(matched_species)]
# Prepare the trait data in the order of the tree
myTrait_fixed <- myTrait[tree$tip.label, ]
# Assuming your trait data is in a column named "lda.LD1"
trait_vector <- myTrait_fixed$PC1
#Pagel's lambda
phylosig(tree, trait_vector, method="lambda", test=TRUE, nsim=999)
#Blomberg's K
phylosig(tree, trait_vector, method="K", test=TRUE, nsim=999)
myTrait_fixed
trait_vector
setwd("~/Desktop/Graduate_school/Projects/morphological_evolution_and_habitat_shifts/environmental_analysis/Phylogenetic_signal")
##################################
# Ancestral reconstruction
##################################
#load combined environmental data
combined = read.csv("combined.csv")
combined.reduced <- distinct(combined, species, .keep_all= TRUE)
summary(combined.reduced)
library(ape)
library(phytools)
library(geiger)
library(dplyr)
library(ggplot2)
##################################
# Ancestral reconstruction
##################################
#load combined environmental data
combined = read.csv("combined.csv")
combined.reduced <- distinct(combined, species, .keep_all= TRUE)
summary(combined.reduced)
#load tree data
tree = read.tree("pruned_tree.tre")
is.ultrametric(tree)
tree = force.ultrametric(tree, method = "extend")
tree <- ladderize(tree)
#bio1
trait.vector = combined.reduced$bio1
names(trait.vector) <- combined.reduced$species
trait.reduced <- treedata(tree, trait.vector)$data
trait.reduced.vector <- trait.reduced[,1]
tree.reduced <- treedata(tree, trait.vector)$phy
# MODEL COMPARISON
fitBM = fitContinuous(tree.reduced, trait.reduced)
fitOU = fitContinuous(tree.reduced, trait.reduced, model = "OU") # Make sure it is truly ultrametric even considering small rounding errors -- even a small discrepancy will cause complaints and longer runtime due to VCF optimization.
fitEB = fitContinuous(tree.reduced, trait.reduced, model = "EB")
fitBM$opt$aicc
fitOU$opt$aicc
fitEB$opt$aicc
# Plot mean annual temperature
figure = contMap(tree.reduced, trait.reduced.vector, plot = FALSE, model = "BM")
plot(setMap(figure, invert = TRUE), legend=4*max(nodeHeights(tree)), fsize=0.6, ftype="i", lwd=c(3,1), lwd=c(3,1), outline = FALSE)
